---
title: 环境搭建
description: 开发环境、依赖与最简容器配置
editLink: true
outline: deep
---

# 环境搭建

> [!NOTE]
> 目标：以最简成本完成本地可运行的开发环境。当前部署相关内容较少，数据库为主要依赖；按需启动各子项目即可。

## Node 与包管理

- 使用 .nvmrc 指定 Node 18 版本，建议安装 nvm 并在进入仓库时自动切换版本
- 包管理采用 pnpm（workspace + filter），避免重复安装与加速依赖解析

```bash
# 安装 pnpm（任选其一）
corepack enable && corepack prepare pnpm@latest --activate
# 或
npm i -g pnpm

# 在仓库根安装依赖
pnpm i
```

## Docker 依赖（最简配置）

- 提供 PostgreSQL / Redis / Mongo 三个服务，建议资源配置 CPU≥2、内存≥2GB
- 端口建议：PostgreSQL 5432、Redis 6379、Mongo 27017（默认端口）

### 自动初始化脚本（优先）

```bash
# 在项目根执行（按操作系统选择）
bash ./init_mac.sh
bash ./init_linux.sh
./init_windows.bat

# 或使用基建脚本（数据库容器）
bash infra/database/scripts/init_mac.sh
bash infra/database/scripts/init_linux.sh
infra/database/scripts/init_windows.bat
```

::: details 手动初始化命令（仅在脚本失败时使用）

```bash
docker run -d --name csisp-postgres -p 5432:5432 -e POSTGRES_PASSWORD=dev postgres:16
docker run -d --name csisp-redis -p 6379:6379 redis:7
docker run -d --name csisp-mongo -p 27017:27017 mongo:6
```

:::

> [!TIP]
> 已安装 Docker Desktop 的情况下，也可通过图形界面创建服务。生产或多人协作建议使用 docker compose 统一声明（后续在“基础设施与基建”细化）。

## Thrift IDL（契约生成）

- 安装 Thrift（macOS 可通过 Homebrew）

```bash
brew install thrift
thrift --version
```

- IDL 文件与生成流程在“基础设施与基建 / IDL（Thrift）”中说明，生成的类型在多项目间复用
- 结合根脚本的 `dev:infra`，可在启动前完成契约生成与数据库初始化（详见“快速开始”）

## 初始化与环境变量

- 统一使用根目录 `.env` 或 `.env.local`，按模块读取
- 建议集中管理以下键名（示例）：

```bash
DATABASE_URL=postgres://postgres:dev@localhost:5432/csisp
REDIS_URL=redis://localhost:6379
MONGO_URL=mongodb://localhost:27017/csisp
```

> [!IMPORTANT]
> 请勿在仓库中提交真实凭证或敏感信息。示例仅用于本地开发，生产环境变量需通过安全方式注入。

## 编辑器与格式

- 推荐 VS Code，启用“保存时格式化”
- 统一 EditorConfig、ESLint、Prettier 规则；前后端遵循一致的代码风格与类型约束

## 下一步

- 首次运行前先执行契约与数据库初始化（`dev:infra`）
- 按需启动单个子项目进行调试；需要后台或后端时优先启动 backend-integrated 或 backoffice
- 文档导航：
  - [快速开始](/src/入门指南/快速开始)
  - [目录结构](/src/入门指南/目录结构)
  - [数据库（PostgreSQL）](/src/基础设施与基建/数据库（PostgreSQL）)
