---
title: 核心模块设计
description: 模块职责、协作与当前最简实现说明
editLink: true
outline: deep
---

# 核心模块设计

> [!NOTE]
> 当前实现以“最简可用”为原则，优先保障开发与联调通畅；后续将按“架构设计 / TODO”进行完整重构与优化。

## 模块总览

| 模块归属             | 模块名称                                   | 主要职责                                         | 关键协作                                                           | 备注                       |
| -------------------- | ------------------------------------------ | ------------------------------------------------ | ------------------------------------------------------------------ | -------------------------- |
| `backend-integrated` | `health`                                   | 健康检查与就绪状态                               | 与数据层（PostgreSQL / Redis / Mongo）连通性校验                   | 最简实现                   |
| `bff`                | `admin` / `portal` 下的 `demo`             | 聚合与编排示例                                   | 路由 → 校验（`zod`）→ 调用上游（`undici` / 内部 RPC）→ 错误映射    | 仅示例，后续按实际场景扩展 |
| `backoffice`         | `auth` / `user` / `db` / `i18n` / `logger` | 登录鉴权、用户管理、数据库状态、国际化、日志查询 | 路由（JSON-RPC）→ 中间件（权限/响应校验/限流/日志/追踪）→ 模块服务 | 当前为最简形态             |
| `frontend-admin`     | 页面与路由组织                             | 中台页面与交互                                   | 状态（`Pinia`）→ 接口（`Axios`）→ 组件（`Naive UI` / 图表）        | 与 BFF / 后端协作          |
| `frontend-portal`    | 页面与路由组织                             | 门户展示与交互                                   | 状态（`Pinia`）→ 接口（`Axios`）→ 组件（`Naive UI` / 图表）        | 与 BFF / 后端协作          |

## 路由与约定

- 统一采用：`POST /api/[project]/[subproject?]/:domain/:action`
  - `project`：`backoffice` / `bff` /（`backend-integrated` 无前缀，仅 `/api`）
  - `subproject`：仅在 `bff` 存在（如 `portal` / `admin`）
  - `domain.action`：标识模块与操作（如 `user.getUser`）
- 请求体不使用 `method` 字段，`method` 由 URL 路由标识；响应遵循 JSON-RPC 2.0
- `backoffice` 的错误码头部约定与响应规范详见专题页：/src/模块详解/backoffice/JSON-RPC路由与响应规范

## 中间件与治理

| 范围                 | 内容                                                                       | 说明                                               | 后续优化                   |
| -------------------- | -------------------------------------------------------------------------- | -------------------------------------------------- | -------------------------- |
| `bff`                | `logger` / `trace` / `rateLimit` / `cors` / `error` / `responseValidation` | 统一日志与追踪、限流、跨域、错误包装与响应校验     | 按场景细化策略与配置       |
| `backoffice`         | `jwtAuth` / `roles` / `rateLimit` / `responseValidation` / `logger`        | 路由级权限控制、令牌校验、限流与响应校验、统一日志 | 与专题页规范对齐并统一策略 |
| `backend-integrated` | 拦截器 / 守卫 / 管道                                                       | 最简鉴权与参数处理                                 | 按业务完善治理链路         |

## 数据访问与缓存

- 数据库：`PostgreSQL`（只读为主），以 `Sequelize` 管理模型与迁移（配合 `Umzug`）；必要处通过 `Kanel` 生成类型
- 缓存与限流：`Redis` 客户端（`redis` / `ioredis`），统一命名空间与 TTL 策略，在中间件层封装限流
- 非结构化内容：`MongoDB`（日志 / 内容 / i18n）

## 配置与类型

- 环境变量统一：根目录 `.env` / `.env.local`，各模块按需读取（例如 `DATABASE_URL`、`REDIS_URL`、`MONGO_URL`）
- 类型共享：`Thrift IDL` 统一生成，跨 `bff` / `backoffice` / `backend-integrated` 复用

## 当前状态与 TODO

- 当前为“最简可用”形态，模块职责清晰但细化治理尚未完成
- 后续需要：
  - 完整的安全架构重构与优化（鉴权/会话、错误码头部、限流与响应校验）  
    记录于：/src/架构设计/TODO
  - 核心模块的抽象边界与可插拔策略完善（`auth` / `user` / `logger` / `db` / `i18n`）  
    记录于：/src/架构设计/TODO

## 相关阅读

- 路由与数据流总览：[总体架构](/src/架构设计/总体架构)
- 接口规范专题：[backoffice / JSON-RPC 路由与响应规范](/src/模块详解/backoffice/JSON-RPC路由与响应规范)
